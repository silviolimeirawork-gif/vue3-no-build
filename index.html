<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue 3 ToDo List No-Build</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        .done { text-decoration: line-through; color: gray; }
    </style>
</head>
<body>

<div id="app" class="container mt-5">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h2 class="card-title mb-0">Minha Lista de Tarefas</h2>
        </div>
        <div class="card-body">
            <!-- Formulário de Adição -->
            <form @submit.prevent="addTodo" class="input-group mb-3">
                <input 
                    v-model="newTodo" 
                    type="text" 
                    class="form-control" 
                    placeholder="Nova tarefa..." 
                    required
                >
                <button class="btn btn-success" type="submit">Adicionar</button>
            </form>

            <!-- Lista de Tarefas -->
            <ul class="list-group">
                <li v-for="todo in todos" :key="todo.id" class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <input 
                            type="checkbox" 
                            class="form-check-input me-2" 
                            v-model="todo.done" 
                            @change="saveToLocalStorage"
                        >
                        <span :class="{ done: todo.done }">{{ todo.text }}</span>
                    </div>
                    <button @click="removeTodo(todo.id)" class="btn btn-danger btn-sm">Excluir</button>
                </li>
            </ul>
            
            <p v-if="todos.length === 0" class="text-center text-muted mt-3">Nenhuma tarefa cadastrada.</p>
        </div>
    </div>
</div>

<script>
    const { createApp, ref, onMounted, watch } = Vue;

    createApp({
        setup() {
            const newTodo = ref('');
            const todos = ref([]);
            const STORAGE_KEY = 'vue3-todo-list';

            // 1. Carregar do LocalStorage ao montar
            onMounted(() => {
                const storedTodos = localStorage.getItem(STORAGE_KEY);
                if (storedTodos) {
                    todos.value = JSON.parse(storedTodos);
                } else {
                    // 2. Fetch API para dados iniciais se localstorage vazio
                    fetch('https://jsonplaceholder.typicode.com')
                        .then(response => response.json())
                        .then(data => {
                            todos.value = data.map(t => ({
                                id: t.id,
                                text: t.title,
                                done: t.completed
                            }));
                            saveToLocalStorage();
                        });
                }
            });

            // 3. Persistir no LocalStorage sempre que 'todos' mudar
            watch(todos, () => {
                saveToLocalStorage();
            }, { deep: true });

            function addTodo() {
                if (newTodo.value.trim() === '') return;
                todos.value.push({
                    id: Date.now(),
                    text: newTodo.value,
                    done: false
                });
                newTodo.value = '';
            }

            function removeTodo(id) {
                todos.value = todos.value.filter(todo => todo.id !== id);
            }

            function saveToLocalStorage() {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(todos.value));
            }

            return {
                newTodo,
                todos,
                addTodo,
                removeTodo,
                saveToLocalStorage
            };
        }
    }).mount('#app');
</script>

<!-- Bootstrap 5 JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
</body>
</html>

